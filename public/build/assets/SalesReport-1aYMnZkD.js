import{m as B,r as d,w as k,j as t,i as H}from"./index-OeoBNat3.js";import{f as V}from"./api-8_quPuaU.js";import{C as q}from"./CRow-B0v1wP3B.js";import{C as L}from"./CCol-BhG1DmFz.js";import{C as O,a as z}from"./CCardBody-HZcxyyc1.js";import{C as G}from"./CCardHeader-D3QUcPyo.js";import{C as J}from"./CForm-nOHKzzo5.js";import{C as x}from"./CFormLabel-DxfY1rNV.js";import{C as j}from"./CFormInput-BMIMxTq1.js";import{a as K}from"./index.esm-BSQayu9G.js";import{C as Q,a as U,b as m,c as n,d as W,e as c}from"./CTable-09JELt_N.js";import{C as p}from"./DefaultLayout-B6SAEV22.js";import"./cil-mobile-BLiG_LYI.js";const lt=()=>{B();const[C,f]=d.useState([]),[g,v]=d.useState(0),[A,S]=d.useState(0),[b,_]=d.useState(0),[D,T]=d.useState(!1),[y,u]=d.useState(!1),{showToast:l}=k(),[o,N]=d.useState({start_date:"",end_date:""}),h=a=>{const{name:r,value:i}=a.target;N({...o,[r]:i})},F=async()=>{try{u(!0);const a=await V("/api/reportSales?startDate="+o.start_date+"&endDate="+o.end_date);if(a){const r=a.reduce((e,s)=>{const E=parseFloat(s.total_amount)||0,I=parseFloat(s.paid_amount)||0;return e[s.invoiceDate]||(e[s.invoiceDate]={invoiceDate:s.invoiceDate,totalAmount:0,paidAmount:0}),e[s.invoiceDate].totalAmount+=E,e[s.invoiceDate].paidAmount+=I,e},{}),i=Object.values(r).map(e=>({...e,totalAmount:Math.round(e.totalAmount),paidAmount:Math.round(e.paidAmount),remainingAmount:Math.round(e.totalAmount-e.paidAmount)}));f(i);const P=i.reduce((e,s)=>e+s.totalAmount,0),w=i.reduce((e,s)=>e+s.paidAmount,0),M=i.reduce((e,s)=>e+s.remainingAmount,0);v(Math.round(P)),S(Math.round(w)),_(Math.round(M))}else l("danger","Failed to fetch records")}catch(a){l("danger","Error occurred "+a)}finally{u(!1)}},R=async a=>{try{const r=a.currentTarget;if(a.preventDefault(),a.stopPropagation(),T(!0),r.checkValidity()){if(o.end_date<o.start_date){l("danger","End date cannot be earlier than start date.");return}await F()}}catch(r){l("danger","Failed to fetch records"+r)}};return t.jsx(q,{children:t.jsx(L,{xs:12,children:t.jsxs(O,{className:"mb-4",children:[t.jsx(G,{children:t.jsx("strong",{children:"Sales Report"})}),t.jsxs(z,{children:[t.jsx(J,{onSubmit:R,noValidate:!0,validated:D,children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-sm-4",children:t.jsxs("div",{className:"mb-1",children:[t.jsx(x,{htmlFor:"start_date",children:"Start Date"}),t.jsx(j,{type:"date",id:"start_date",name:"start_date",value:o.start_date,onChange:h,required:!0,feedbackInvalid:"Please select date."})]})}),t.jsx("div",{className:"col-sm-4",children:t.jsxs("div",{className:"mb-1",children:[t.jsx(x,{htmlFor:"end_date",children:"End Date"}),t.jsx(j,{type:"date",id:"end_date",name:"end_date",value:o.end_date,onChange:h,required:!0,feedbackInvalid:"Please select date."})]})}),t.jsx("div",{className:"col-sm-4",children:t.jsx("div",{className:"mb-1 mt-4",children:t.jsx(K,{color:"success",type:"submit",children:"Submit"})})})]})}),t.jsx("hr",{}),t.jsx("div",{className:"table-responsive",children:y?t.jsx(H,{color:"primary"}):t.jsxs(Q,{children:[t.jsx(U,{children:t.jsxs(m,{children:[t.jsx(n,{children:"Invoice Date"}),t.jsx(n,{children:"Total Amount"}),t.jsx(n,{children:"Paid Amount"}),t.jsx(n,{children:"Remaining Amount"})]})}),t.jsxs(W,{children:[C.map((a,r)=>t.jsxs(m,{children:[t.jsx(c,{children:a.invoiceDate}),t.jsx(c,{children:a.totalAmount}),t.jsx(c,{children:a.paidAmount}),t.jsx(c,{children:a.remainingAmount})]},r)),t.jsxs(m,{children:[t.jsx(n,{children:"Total"}),t.jsx(n,{children:g}),t.jsx(n,{children:t.jsx(p,{color:"success",children:A})}),t.jsx(n,{children:t.jsx(p,{color:"danger",children:b})})]})]})]})})]})]})})})};export{lt as default};
