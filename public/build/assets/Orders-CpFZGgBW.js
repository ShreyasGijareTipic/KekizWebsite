import{w as R,r as o,j as a}from"./index-CoZNXrT3.js";import{M as T}from"./mantine-react-table.esm-Ctn8PAc_.js";import{f as z,j as f}from"./api-8_quPuaU.js";import{C as L}from"./ConfirmationModal-nQXrvx9v.js";import{c as _}from"./index.esm-DG3saitl.js";import{u as V,C as h}from"./DefaultLayout-BFij5oOH.js";import{C as U}from"./CRow-C1kAJa4E.js";import{C as q}from"./CCol-6gv0qfQb.js";import{c as F}from"./cil-phone-4mwkG2LD.js";import{c as X}from"./cil-chat-bubble-De0T3Ux-.js";import"./Table-p3TMRkA8.js";import"./CModalTitle-yUagMCk3.js";import"./cil-mobile-BFL8AfvV.js";const ne=()=>{const{showToast:t}=R(),{t:v}=V("global"),[B,x]=o.useState([]),[d,S]=o.useState(),[I,b]=o.useState(!1),[c,P]=o.useState({pageIndex:0,pageSize:25}),[$,k]=o.useState(0),[D,w]=o.useState(!1),[N,y]=o.useState(!1);o.useState(null);const u=window.location.href.split("/").pop(),m=async()=>{try{w(!0),y(!0);const r=await z(`/api/order?orderType=${u==="bookings"?2:-1}&page=${c.pageIndex+1}&perPage=${c.pageSize}`);x(u==="bookings"?r.data.filter(s=>s.order_status===2):r.data),k(r.total)}catch(e){t("danger","Error occurred "+e)}finally{w(!1),y(!1)}};o.useEffect(()=>{m()},[c.pageIndex,c.pageSize,u]);const A=async()=>{try{await f(`/api/order/${d.id}/cancel`),b(!1),t("success","Order is canceled"),m()}catch(e){t("danger","Error occurred "+e)}},E=async e=>{try{await f(`/api/order/${e}/deliver`),t("success","Order marked as delivered"),m()}catch(r){t("danger","Error occurred "+r)}},[p,j]=o.useState({}),K=(e,r)=>{j(s=>({...s,[e]:r}))},O=async(e,r)=>{var l,n;const s=r||p[e]||0;if(s===""){t("danger","Balance amount is required");return}try{const i=await f(`/api/order/${e}/balance`,{balance_amount:s});(i==null?void 0:i.message)==="Balance and Paid amount updated successfully"&&(t("success","Balance amount updated"),m(),j(g=>{const C={...g};return delete C[e],C}))}catch(i){t("danger","Error occurred: "+(((n=(l=i.response)==null?void 0:l.data)==null?void 0:n.message)||i.message))}},M=[{accessorKey:"customer.name",header:"Name"},{id:"items",header:"Items",Cell:({cell:e})=>{const r=e.row.original.order_items||[],s=e.row.original.custom_products||[],l=[...r,...s];return l.length>0?a.jsx("table",{className:"table table-sm",children:a.jsx("tbody",{children:l.map((n,i)=>{var g;return a.jsxs("tr",{children:[a.jsx("td",{children:((g=n.product)==null?void 0:g.name)||n.name||"N/A"}),a.jsxs("td",{children:[n.qty," X ",n.price,"₹"]}),a.jsx("td",{children:n.size||"-"})]},i)})})}):"Only cash collected"}},{accessorKey:"invoiceDate",header:"Invoice Date"},{accessorKey:"delivery_date",header:"Delivery Date"},{accessorKey:"paid_amount",header:"Paid"},{accessorKey:"total_amount",header:"Total"},{accessorKey:"balance_amount",header:"Balance Amount",Cell:({cell:e})=>a.jsxs("span",{children:[e.row.original.balance_amount," ₹"]})},{accessorKey:"discount",header:"Discount",Cell:({cell:e})=>a.jsxs("span",{children:[e.row.original.discount,"%"]})},{id:"update_balance",header:"Update Balance",Cell:({cell:e})=>{const r=e.row.original.id;return a.jsx("div",{className:"d-flex",children:e.row.original.balance_amount>0&&e.row.original.order_status!==0&&a.jsxs("div",{className:"mt-2",children:[a.jsx("input",{type:"number",value:p[r]!==void 0?p[r]:e.row.original.balance_amount,onChange:s=>K(r,s.target.value),className:"form-control",placeholder:"Enter Balance Amount"}),a.jsx("button",{className:"btn btn-primary btn-sm mt-2",onClick:()=>O(r,p[r]||e.row.original.balance_amount),children:"Update Balance"})]})})}},{accessorKey:"customer.mobile",header:"Call",Cell:({cell:e})=>{var r,s;return a.jsxs("div",{children:[a.jsx("a",{className:"btn btn-outline-info btn-sm",href:`tel:+91${(r=e.row.original.customer)==null?void 0:r.mobile}`,children:a.jsx(_,{icon:F})}),"  ",a.jsx("a",{className:"btn btn-outline-success btn-sm",href:`sms:+91${(s=e.row.original.customer)==null?void 0:s.mobile}?body=Outstanding payment: Rs. ${e.row.original.balance_amount}`,children:a.jsx(_,{icon:X})})]})}},{id:"actions",header:"Actions",Cell:({cell:e})=>a.jsx("div",{children:e.row.original.order_status===0?a.jsx(h,{color:"danger",children:"Canceled"}):u==="bookings"&&e.row.original.order_status===2?a.jsxs(a.Fragment,{children:[a.jsx(h,{color:"success",style:{cursor:"pointer"},onClick:()=>E(e.row.original.id),children:"Mark as Delivered"})," ",a.jsx(h,{color:"danger",style:{cursor:"pointer"},onClick:()=>{S(e.row.original),b(!0)},children:"Cancel"})]}):a.jsx(h,{color:"info",style:{cursor:"pointer"},onClick:()=>window.location.href=`/#/invoice-details/${e.row.original.id}`,children:"View"})})}];return a.jsxs(U,{children:[a.jsx(L,{visible:I,setVisible:b,onYes:A,resource:`${v("LABELS.cancel_order")} -`+(d==null?void 0:d.id)}),a.jsxs(q,{xs:12,children:[a.jsx("h2",{className:"text-center",children:"Orders"}),a.jsx(T,{columns:M,data:B,state:{isLoading:D,pagination:c,showProgressBars:N},manualPagination:!0,onPaginationChange:P,rowCount:$,enableFullScreenToggle:!1})]})]})};export{ne as default};
