import{w as O,r as t,j as a}from"./index-Bg23EJBh.js";import{M}from"./mantine-react-table.esm-Q6Itqhmp.js";import{f as R,j as g}from"./api-8_quPuaU.js";import{C as T}from"./ConfirmationModal-CQe-o_rD.js";import{c as y}from"./index.esm-8VmjjbFz.js";import{u as z,C as m}from"./DefaultLayout-ClwM_41s.js";import{C as L}from"./CRow-Cu5LofkQ.js";import{C as V}from"./CCol-YFH1-bI8.js";import{c as U}from"./cil-phone-4mwkG2LD.js";import{c as q}from"./cil-chat-bubble-De0T3Ux-.js";import"./Table-AyJUSGqJ.js";import"./CModalTitle-CtLHuCtH.js";import"./cil-mobile-BTelR--Q.js";const oe=()=>{const{showToast:n}=O(),{t:C}=z("global"),[v,f]=t.useState([]),[l,_]=t.useState(),[B,h]=t.useState(!1),[i,I]=t.useState({pageIndex:0,pageSize:25}),[S,P]=t.useState(0),[$,x]=t.useState(!1),[k,b]=t.useState(!1),[p,w]=t.useState(null),d=window.location.href.split("/").pop(),u=async()=>{try{x(!0),b(!0);const r=await R(`/api/order?orderType=${d==="bookings"?2:-1}&page=${i.pageIndex+1}&perPage=${i.pageSize}`);f(d==="bookings"?r.data.filter(o=>o.order_status===2):r.data),P(r.total)}catch(e){n("danger","Error occurred "+e)}finally{x(!1),b(!1)}};t.useEffect(()=>{u()},[i.pageIndex,i.pageSize,d]);const D=async()=>{try{await g(`/api/order/${l.id}/cancel`),h(!1),n("success","Order is canceled"),u()}catch(e){n("danger","Error occurred "+e)}},N=async e=>{try{await g(`/api/order/${e}/deliver`),n("success","Order marked as delivered"),u()}catch(r){n("danger","Error occurred "+r)}},A=async(e,r)=>{var o,c;if(r===null||r===""){n("danger","Balance amount is required");return}try{const s=await g(`/api/order/${e}/balance`,{balance_amount:r});(s==null?void 0:s.message)==="Balance and Paid amount updated successfully"&&(n("success","Balance amount updated"),u(),w(null))}catch(s){n("danger","Error occurred: "+(((c=(o=s.response)==null?void 0:o.data)==null?void 0:c.message)||s.message))}},E=[{accessorKey:"customer.name",header:"Name"},{accessorKey:"customer.mobile",header:"Call",Cell:({cell:e})=>{var r,o;return a.jsxs("div",{children:[a.jsx("a",{className:"btn btn-outline-info btn-sm",href:`tel:+91${(r=e.row.original.customer)==null?void 0:r.mobile}`,children:a.jsx(y,{icon:U})}),"  ",a.jsx("a",{className:"btn btn-outline-success btn-sm",href:`sms:+91${(o=e.row.original.customer)==null?void 0:o.mobile}?body=Outstanding payment: Rs. ${e.row.original.balance_amount}`,children:a.jsx(y,{icon:q})})]})}},{id:"items",header:"Items",Cell:({cell:e})=>{const r=e.row.original.order_items||[],o=e.row.original.custom_products||[],c=[...r,...o];return c.length>0?a.jsx("table",{className:"table table-sm",children:a.jsx("tbody",{children:c.map((s,K)=>{var j;return a.jsxs("tr",{children:[a.jsx("td",{children:((j=s.product)==null?void 0:j.name)||s.name||"N/A"}),a.jsxs("td",{children:[s.qty," X ",s.price,"₹"]}),a.jsx("td",{children:s.size||"-"})]},K)})})}):"Only cash collected"}},{accessorKey:"paid_amount",header:"Paid"},{accessorKey:"total_amount",header:"Total"},{accessorKey:"balance_amount",header:"Balance Amount",Cell:({cell:e})=>a.jsxs("span",{children:[e.row.original.balance_amount," ₹"]})},{accessorKey:"discount",header:"Discount"},{accessorKey:"invoiceDate",header:"Invoice Date"},{accessorKey:"delivery_date",header:"Delivery Date"},{id:"update_balance",header:"Update Balance",Cell:({cell:e})=>a.jsx("div",{className:"d-flex",children:e.row.original.balance_amount>0&&e.row.original.order_status!==0&&a.jsxs("div",{className:"mt-2",children:[a.jsx("input",{type:"number",value:p!==null?p:e.row.original.balance_amount,onChange:r=>w(r.target.value),className:"form-control",placeholder:"Enter Balance Amount"}),a.jsx("button",{className:"btn btn-primary btn-sm mt-2",onClick:()=>A(e.row.original.id,p||e.row.original.balance_amount),children:"Update Balance"})]})})},{id:"actions",header:"Actions",Cell:({cell:e})=>a.jsx("div",{children:e.row.original.order_status===0?a.jsx(m,{color:"danger",children:"Canceled"}):d==="bookings"&&e.row.original.order_status===2?a.jsxs(a.Fragment,{children:[a.jsx(m,{color:"success",onClick:()=>N(e.row.original.id),children:"Mark as Delivered"})," ",a.jsx(m,{color:"danger",onClick:()=>{_(e.row.original),h(!0)},children:"Cancel"})]}):a.jsx(m,{color:"info",onClick:()=>window.location.href=`/#/invoice-details/${e.row.original.id}`,children:"View"})})}];return a.jsxs(L,{children:[a.jsx(T,{visible:B,setVisible:h,onYes:D,resource:`${C("LABELS.cancel_order")} -`+(l==null?void 0:l.id)}),a.jsxs(V,{xs:12,children:[a.jsx("h2",{className:"text-center",children:"Orders"}),a.jsx(M,{columns:E,data:v,state:{isLoading:$,pagination:i,showProgressBars:k},manualPagination:!0,onPaginationChange:I,rowCount:S})]})]})};export{oe as default};
