import{r as i,w as $,j as e}from"./index-CoZNXrT3.js";import{f}from"./api-8_quPuaU.js";import{C as k}from"./CRow-C1kAJa4E.js";import{C as H}from"./CCol-6gv0qfQb.js";import{C as V,a as q}from"./CCardBody-KiBmAR96.js";import{C as z}from"./CCardHeader-CzKoGM0V.js";import{C as G}from"./CForm-CWuSMnRv.js";import{C}from"./CFormLabel-DOuP-TYD.js";import{C as b}from"./CFormInput-D071rTfS.js";import{a as J}from"./index.esm-DG3saitl.js";import{C as K,a as M,b as u,c as l,d as Q,e as x}from"./CTable-CY_BSGVv.js";import{C as v}from"./DefaultLayout-BFij5oOH.js";import"./cil-mobile-BFL8AfvV.js";const de=()=>{const[d,S]=i.useState({start_date:"",end_date:""}),[D,E]=i.useState([]),[_,g]=i.useState(!1),[T,L]=i.useState(0),[A,P]=i.useState(0),[h,w]=i.useState(0),{showToast:c}=$(),j=t=>{const{name:n,value:s}=t.target;S({...d,[n]:s})},O=async()=>{try{const t=await f(`/api/reportSales?startDate=${d.start_date}&endDate=${d.end_date}`);if(t){const n=t.reduce((s,a)=>(s[a.invoiceDate]||(s[a.invoiceDate]={invoiceDate:a.invoiceDate,totalAmount:0,paidAmount:0}),s[a.invoiceDate].totalAmount+=a.totalAmount,s[a.invoiceDate].paidAmount+=a.paidAmount,s),{});return Object.values(n).map(s=>({...s,remainingAmount:s.totalAmount-s.paidAmount}))}else c("danger","Failed to fetch sales records")}catch(t){c("danger","Error occured "+t)}},N=async()=>{try{const t=await f(`/api/expense?startDate=${d.start_date}&endDate=${d.end_date}`);if(t){const n=t.reduce((s,a)=>(s[a.expense_date]||(s[a.expense_date]={expense_date:a.expense_date,totalExpense:0}),s[a.expense_date].totalExpense+=a.total_price,s),{});return Object.values(n)}else c("danger","Failed to fetch expense records")}catch(t){c("danger","Error occured "+t)}},y=async()=>{try{const t=await O(),n=await N(),a=[...t,...n].reduce((r,o)=>{const m=o.invoiceDate||o.expense_date;return r[m]||(r[m]={date:m,totalSales:0,totalExpenses:0}),o.totalAmount&&(r[m].totalSales+=o.totalAmount),o.totalExpense&&(r[m].totalExpenses+=o.totalExpense),r},{}),p=Object.values(a).map(r=>({...r,profitOrLoss:r.totalSales-r.totalExpenses})),R=p.reduce((r,o)=>r+o.totalSales,0),B=p.reduce((r,o)=>r+o.totalExpenses,0),I=p.reduce((r,o)=>r+o.profitOrLoss,0);E(p),L(R),P(B),w(I)}catch(t){c("danger","Error occured "+t)}},F=async t=>{t.preventDefault(),t.stopPropagation(),g(!0),t.currentTarget.checkValidity()&&await y()};return e.jsx(k,{children:e.jsx(H,{xs:12,children:e.jsxs(V,{className:"mb-4",children:[e.jsx(z,{children:e.jsx("strong",{children:"Profit and Loss Report"})}),e.jsxs(q,{children:[e.jsx(G,{onSubmit:F,noValidate:!0,validated:_,children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-4",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(C,{htmlFor:"start_date",children:"Start Date"}),e.jsx(b,{type:"date",id:"start_date",name:"start_date",value:d.start_date,onChange:j,required:!0,feedbackInvalid:"Please select date."})]})}),e.jsx("div",{className:"col-sm-4",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(C,{htmlFor:"end_date",children:"End Date"}),e.jsx(b,{type:"date",id:"end_date",name:"end_date",value:d.end_date,onChange:j,required:!0,feedbackInvalid:"Please select date."})]})}),e.jsx("div",{className:"col-sm-4",children:e.jsx("div",{className:"mb-1 mt-4",children:e.jsx(J,{color:"success",type:"submit",children:"Submit"})})})]})}),e.jsx("hr",{}),e.jsx("div",{className:"table-responsive",children:e.jsxs(K,{children:[e.jsx(M,{children:e.jsxs(u,{children:[e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Total Sales"}),e.jsx(l,{children:"Total Expenses"}),e.jsx(l,{children:"Profit/Loss"})]})}),e.jsxs(Q,{children:[D.map((t,n)=>e.jsxs(u,{children:[e.jsx(x,{children:t.date}),e.jsx(x,{children:t.totalSales}),e.jsx(x,{children:t.totalExpenses}),e.jsx(x,{children:e.jsx(v,{color:t.profitOrLoss>=0?"success":"danger",children:t.profitOrLoss})})]},n)),e.jsxs(u,{children:[e.jsx(l,{children:"Total"}),e.jsx(l,{children:T}),e.jsx(l,{children:A}),e.jsx(l,{children:e.jsx(v,{color:h>=0?"success":"danger",children:h})})]})]})]})})]})]})})})};export{de as default};
