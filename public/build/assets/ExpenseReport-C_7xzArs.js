import{m as B,r as o,w as q,j as e}from"./index-CoZNXrT3.js";import{f,m as H,p as M}from"./api-8_quPuaU.js";import{C as L}from"./ConfirmationModal-nQXrvx9v.js";import{C as O}from"./CRow-C1kAJa4E.js";import{C as Q}from"./CCol-6gv0qfQb.js";import{C as U,a as Y}from"./CCardBody-KiBmAR96.js";import{C as z}from"./CCardHeader-CzKoGM0V.js";import{C as G}from"./CForm-CWuSMnRv.js";import{C as y}from"./CFormLabel-DOuP-TYD.js";import{C as b}from"./CFormInput-D071rTfS.js";import{a as J}from"./index.esm-DG3saitl.js";import{C as K,a as W,b as u,c as a,d as X,e as n}from"./CTable-CY_BSGVv.js";import{C as h}from"./DefaultLayout-BFij5oOH.js";import"./CModalTitle-yUagMCk3.js";import"./cil-mobile-BFL8AfvV.js";const pe=()=>{B();const[E,g]=o.useState({}),[v,_]=o.useState([]),[T,w]=o.useState(0),[x,D]=o.useState(),[S,N]=o.useState(!1),[V,p]=o.useState(!1),{showToast:l}=q(),[i,I]=o.useState({start_date:"",end_date:""}),P=async()=>{try{const t=(await f("/api/expenseType")).reduce((d,j)=>(d[j.id]=j.name,d),{});g(t)}catch(s){l("danger","Error occured "+s)}},C=s=>{const{name:t,value:d}=s.target;I({...i,[t]:d})},m=async()=>{try{const s=await f("/api/expense?startDate="+i.start_date+"&endDate="+i.end_date);if(s){_(s);const t=s.reduce((c,r)=>r.show?c+r.total_price:c,0);w(t);const d=s.reduce((c,r)=>(c[r.expense_date]||(c[r.expense_date]={expense_date:r.expense_date,totalExpense:0}),c[r.expense_date].totalExpense+=r.total_price,c),{}),j=Object.values(d)}else l("danger","Failed to fetch records")}catch(s){l("danger","Error occured "+s)}},F=async s=>{try{const t=s.currentTarget;s.preventDefault(),s.stopPropagation(),N(!0),t.checkValidity()&&await m()}catch(t){l("danger","Error occured "+t)}};o.useEffect(()=>{P()},[]);const k=s=>{D(s),p(!0)},R=async()=>{try{await H("/api/expense/"+x.id),p(!1),m()}catch(s){l("danger","Error occured "+s)}},A=async s=>{try{await M("/api/expense/"+s.id,{...s,show:!s.show}),m()}catch(t){l("danger","Error occured "+t)}};return e.jsxs(O,{children:[e.jsx(L,{visible:V,setVisible:p,onYes:R,resource:"Delete expense - "+(x==null?void 0:x.name)}),e.jsx(Q,{xs:12,children:e.jsxs(U,{className:"mb-4",children:[e.jsx(z,{children:e.jsx("strong",{children:"Expense Report"})}),e.jsxs(Y,{children:[e.jsx(G,{noValidate:!0,validated:S,onSubmit:F,children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-4",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(y,{htmlFor:"invoiceDate",children:"Start Date"}),e.jsx(b,{type:"date",id:"start_date",name:"start_date",value:i.start_date,onChange:C,required:!0,feedbackInvalid:"Please select date."})]})}),e.jsx("div",{className:"col-sm-4",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(y,{htmlFor:"invoiceDate",children:"End Date"}),e.jsx(b,{type:"date",id:"end_date",name:"end_date",value:i.end_date,onChange:C,required:!0,feedbackInvalid:"Please select date."})]})}),e.jsx("div",{className:"col-sm-4",children:e.jsx("div",{className:"mb-1 mt-4",children:e.jsx(J,{color:"success",type:"submit",children:"Submit"})})})]})}),e.jsx("hr",{}),e.jsx("div",{className:"table-responsive",children:e.jsxs(K,{children:[e.jsx(W,{children:e.jsxs(u,{children:[e.jsx(a,{scope:"col",children:"Id"}),e.jsx(a,{scope:"col",children:"Date"}),e.jsx(a,{scope:"col",children:"Expense Type"}),e.jsx(a,{scope:"col",children:"Details"}),e.jsx(a,{scope:"col",children:"Quantity"}),e.jsx(a,{scope:"col",children:"Price Per Unit"}),e.jsx(a,{scope:"col",children:"Total Cost"}),e.jsx(a,{scope:"col",children:"Status"}),e.jsx(a,{scope:"col",children:"Actions"})]})}),e.jsxs(X,{children:[v.map((s,t)=>e.jsxs(u,{children:[e.jsx(a,{scope:"row",children:t+1}),e.jsx(n,{children:s.expense_date}),e.jsx(n,{children:E[s.expense_id]}),e.jsx(n,{children:s.name}),e.jsx(n,{children:s.qty}),e.jsx(n,{children:s.price}),e.jsx(n,{children:s.total_price}),e.jsx(n,{children:s.show==1?e.jsx(h,{color:"success",children:"Valid"}):e.jsx(h,{color:"danger",children:"Invalid"})}),e.jsxs(n,{children:[e.jsx(h,{color:"info",onClick:()=>{A(s)},children:"Change Validity"})," ","Â ",e.jsx(h,{color:"danger",onClick:()=>{k(s)},children:"Delete"})]})]},s.slug+s.id)),e.jsxs(u,{children:[e.jsx(a,{scope:"row"}),e.jsx(a,{className:"text-end",colSpan:5,children:"Total "}),e.jsx(a,{colSpan:3,children:T})]})]})]})})]})]})})]})};export{pe as default};
