import{a as c,r as x,m as D,j as e}from"./index-CWCk8Mfu.js";import{a as _}from"./axios-upsvKRUO.js";import{G as F,T as W,S as U,a as H,B as T}from"./Table-DlhIHgLf.js";function j(){return j=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])}return r},j.apply(this,arguments)}function R(r,n){if(r==null)return{};var o={},s=Object.keys(r),i,a;for(a=0;a<s.length;a++)i=s[a],!(n.indexOf(i)>=0)&&(o[i]=r[i]);return o}function L(r,n){if(r==null)return{};var o=R(r,n),s,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(i=0;i<a.length;i++)s=a[i],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(r,s)&&(o[s]=r[s])}return o}var q=["size","color"];function w(r){var n=r.size,o=n===void 0?24:n,s=r.color,i=s===void 0?"currentColor":s,a=L(r,q);return c.createElement("svg",j({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-arrow-down",width:o,height:o,viewBox:"0 0 24 24",stroke:i,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},a),c.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),c.createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),c.createElement("line",{x1:"18",y1:"13",x2:"12",y2:"19"}),c.createElement("line",{x1:"6",y1:"13",x2:"12",y2:"19"}))}var G=["size","color"];function v(r){var n=r.size,o=n===void 0?24:n,s=r.color,i=s===void 0?"currentColor":s,a=L(r,G);return c.createElement("svg",j({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-arrow-up",width:o,height:o,viewBox:"0 0 24 24",stroke:i,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},a),c.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),c.createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),c.createElement("line",{x1:"18",y1:"11",x2:"12",y2:"5"}),c.createElement("line",{x1:"6",y1:"11",x2:"12",y2:"5"}))}const K=()=>{var E;const[r,n]=x.useState([]),[o,s]=x.useState([]),[i,a]=x.useState(!0),[C,O]=x.useState(null),[y,N]=x.useState(""),[f,z]=x.useState(null),[h,P]=x.useState({key:null,direction:"asc"}),$=D(),S={1:"Dr Assist",2:"Aqua Logix"},m=JSON.parse(localStorage.getItem("userData")||"{}"),g=2,p=(E=m==null?void 0:m.user)==null?void 0:E.id;x.useEffect(()=>{p&&(async()=>{try{const d=(await _.get(`http://127.0.0.1:8000/api/tickets/${g}/${p}`)).data.sort((u,b)=>b.id-u.id);n(d),s(d)}catch(l){console.error("Error fetching tickets:",l),O("Unable to fetch tickets.")}finally{a(!1)}})()},[g,p]),x.useEffect(()=>{const t=r.filter(l=>{const d=l.products_id===g,u=p?l.user_id===p:!0,b=l.client_name.toLowerCase().includes(y.toLowerCase())||l.email.toLowerCase().includes(y.toLowerCase())||(S[l.products_id]||"").toLowerCase().includes(y.toLowerCase()),I=f===null||l.status===f;return d&&u&&b&&I});s(t)},[y,f,r,g,p]);const A=async t=>{try{await _.delete(`http://127.0.0.1:8000/api/tickets/${t}`),n(r.filter(l=>l.id!==t))}catch{alert("Failed to delete ticket")}},M=t=>$(`/ExistingTicketView/${t}`),k=t=>{const l=h.key===t&&h.direction==="asc"?"desc":"asc",d=[...o].sort((u,b)=>u[t]<b[t]?l==="asc"?-1:1:u[t]>b[t]?l==="asc"?1:-1:0);s(d),P({key:t,direction:l})};if(i)return e.jsx("p",{children:"Loading tickets..."});if(C)return e.jsx("p",{children:C});const B=t=>t===0?"#bbdefb":t===1?"#fff9c4":"#ffcdd2";return e.jsxs("div",{style:{padding:"16px",maxWidth:"1200px",margin:"0 auto"},children:[e.jsx("h1",{style:{textAlign:"center",marginBottom:"16px"},children:"Existing Tickets"}),e.jsxs(F,{position:"apart",style:{marginBottom:"16px"},children:[e.jsx(W,{placeholder:"Search by Client Name, Email, or Product",value:y,onChange:t=>N(t.target.value),style:{width:"300px"}}),e.jsx(U,{placeholder:"Filter by Status",value:f,onChange:z,data:[{value:null,label:"All"},{value:0,label:"New"},{value:1,label:"In Process"},{value:2,label:"Closed"}],style:{width:"200px"}})]}),e.jsxs(H,{striped:!0,highlightOnHover:!0,style:{border:"2px solid black",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{style:{border:"1px solid black"},onClick:()=>k("id"),children:["Ticket ID"," ",h.key==="id"&&(h.direction==="asc"?e.jsx(v,{}):e.jsx(w,{}))]}),e.jsxs("th",{style:{border:"1px solid black"},onClick:()=>k("products_id"),children:["Product"," ",h.key==="products_id"&&(h.direction==="asc"?e.jsx(v,{}):e.jsx(w,{}))]}),e.jsxs("th",{style:{border:"1px solid black"},onClick:()=>k("client_name"),children:["Client Name"," ",h.key==="client_name"&&(h.direction==="asc"?e.jsx(v,{}):e.jsx(w,{}))]}),e.jsx("th",{style:{border:"1px solid black"},children:"Email"}),e.jsx("th",{style:{border:"1px solid black"},children:"Mobile"}),e.jsx("th",{style:{border:"1px solid black"},children:"Query"}),e.jsx("th",{style:{border:"1px solid black"},children:"Screenshots"}),e.jsx("th",{style:{border:"1px solid black"},children:"Status"}),e.jsx("th",{style:{border:"1px solid black"},children:"Actions"})]})}),e.jsx("tbody",{children:o.map(t=>e.jsxs("tr",{style:{backgroundColor:B(t.status),border:"1px solid black"},children:[e.jsx("td",{style:{border:"1px solid black"},children:t.id}),e.jsx("td",{style:{border:"1px solid black"},children:S[t.products_id]||"Unknown"}),e.jsx("td",{style:{border:"1px solid black"},children:t.client_name}),e.jsx("td",{style:{border:"1px solid black"},children:t.email||"No Email"}),e.jsx("td",{style:{border:"1px solid black"},children:t.mobile||"No Mobile"}),e.jsx("td",{style:{border:"1px solid black"},children:t.query||"No Query"}),e.jsx("td",{style:{border:"1px solid black"},children:t.screen_shot&&Array.isArray(t.screen_shot)?t.screen_shot.map((l,d)=>e.jsx("a",{href:`http://127.0.0.1:8000${l}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:`http://127.0.0.1:8000${l}`,alt:`Screenshot ${d}`,style:{width:"40px",height:"40px"}})},d)):"No Screenshot"}),e.jsx("td",{style:{border:"1px solid black"},children:t.status===0?"New":t.status===1?"In Process":"Closed"}),e.jsx("td",{style:{padding:"10px",textAlign:"center",border:"2px solid black"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[e.jsx(T,{color:"green",onClick:()=>M(t.id),style:{padding:"6px 10px",fontSize:"14px"},children:"View"}),e.jsx(T,{color:"red",onClick:()=>A(t.id),style:{padding:"6px 10px",fontSize:"14px"},children:"Delete"})]})})]},t.id))})]})]})};export{K as default};
