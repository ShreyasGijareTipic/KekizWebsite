import{y as N,m as _,r,j as e}from"./index-Bg23EJBh.js";import{a as i}from"./axios-upsvKRUO.js";const k=()=>{var h;const{id:n}=N(),g=_(),[s,o]=r.useState(null),[m,a]=r.useState(!0),[l,j]=r.useState("");r.useState(null);const[c,y]=r.useState(""),[p,b]=r.useState(""),[x,f]=r.useState([]);r.useEffect(()=>{i.get(`http://127.0.0.1:8000/api/tickets/assign/${n}`).then(t=>{var d;if((d=t.data)!=null&&d.screen_shot)try{const u=JSON.parse(t.data.screen_shot);t.data.screenshots=u}catch{t.data.screenshots=[]}else t.data.screenshots=[];o(t.data),b(t.data.client_name||""),a(!1)}).catch(()=>{j("Could not load ticket details."),a(!1)}),i.get(`http://127.0.0.1:8000/api/tickets/history/${n}`).then(t=>{f(t.data||[])}).catch(()=>{console.error("Could not fetch ticket history")})},[n]);const A=()=>{const t={ticket_id:n,query:s.query||"",comment:c,comment_by:p,status:1,comment_is_user:2};i.post("http://127.0.0.1:8000/api/ticket-details",t).then(()=>i.post(`http://127.0.0.1:8000/api/tickets/update-status/${n}`,{status:1})).then(()=>{o(d=>({...d,status:1})),alert("Ticket status updated to In Process."),g("/ExistingTicketTable")}).catch(()=>{alert("Failed to update ticket details or status. Please try again.")})},S=t=>t?new Date(t).toLocaleString():"N/A",C=t=>{switch(t){case 0:return"Admin";case 1:return"Support Engineer";case 2:return"User";default:return"Unknown"}};return m?e.jsx("p",{children:"Loading..."}):l?e.jsx("p",{style:{color:"red"},children:l}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h1",{style:{marginBottom:"20px",textAlign:"center"},children:"Ticket Assignment Details"}),e.jsx("h3",{children:"Ticket Details"}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"15px",borderRadius:"5px",marginBottom:"20px",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.1)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ticket ID:"})," ",(s==null?void 0:s.id)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Product ID:"})," ",(s==null?void 0:s.products_id)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Client Name:"})," ",(s==null?void 0:s.client_name)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",(s==null?void 0:s.email)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",(s==null?void 0:s.mobile)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Query:"})," ",(s==null?void 0:s.query)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Screenshots:"}),((h=s==null?void 0:s.screenshots)==null?void 0:h.length)>0?s.screenshots.map((t,d)=>e.jsx("a",{href:`http://127.0.0.1:8000${t}`,target:"_blank",rel:"noopener noreferrer",style:{marginRight:"8px"},children:e.jsx("img",{src:`http://127.0.0.1:8000${t}`,alt:`screenshot ${d}`,style:{width:"50px",height:"50px",objectFit:"cover"}})},d)):"No screenshots available"]})]}),e.jsx("h3",{children:"Add Comment and Actions"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",alignItems:"flex-start",marginBottom:"20px"},children:[e.jsx("input",{type:"text",placeholder:"Comment",value:c,onChange:t=>y(t.target.value),style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"5px"}}),e.jsx("input",{type:"text",placeholder:"Comment By",value:p,disabled:!0,style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"5px"}}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",gap:"10px"},children:e.jsx("button",{onClick:A,style:{backgroundColor:"#007bff",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer",width:"100%"},children:"Submit"})})]}),e.jsx("h3",{children:"Ticket History"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0px 2px 5px rgba(0, 0, 0, 0.1)"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"10px"},children:"Comment"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"10px"},children:"Comment By"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"10px"},children:"Date"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"10px"},children:"Role"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"10px"},children:"Assigned"})]})}),e.jsx("tbody",{children:x.length>0?x.map((t,d)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"10px"},children:t.comment}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"10px"},children:t.comment_by}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"10px"},children:S(t.created_at)}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"10px"},children:C(t.comment_is_user)}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"10px"},children:t.status===1?"Assigned":t.status===2?"Closed":"N/A"})]},d)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",style:{textAlign:"center"},children:"No History Available"})})})]})]})};export{k as default};
